<?xml version="1.0"?>

<project    default="dist"
            xmlns:j="jelly:core"
            xmlns:ant="jelly:ant"
            xmlns:maven="jelly:maven">


    <preGoal name="war:war">
       <attainGoal name="jar:jar"/>
       <ant:copy todir="${maven.war.webapp.dir}/WEB-INF/lib/" overwrite="false"
                  file="${maven.build.dir}/${maven.final.name}.jar" />
    </preGoal>
            
    <postGoal name="dist">
		<attainGoal name="jar:install"/>
	</postGoal>

	<postGoal name="dist:prepare-bin-filesystem">

      <attainGoal name="war:war"/>
      <attainGoal name="readme"/>
      <ant:echo message="jar ${maven.build.dir}/${maven.final.name}.jar" />
      <ant:copy todir="${maven.dist.bin.assembly.dir}">
		  <ant:fileset dir="${basedir}">
			<ant:include name="NOTICE*"/>
			<ant:include name="README.txt"/>
		  </ant:fileset>
		</ant:copy>
  
      <ant:copy file="${maven.war.build.dir}/${maven.war.final.name}" 
                todir="${maven.dist.bin.assembly.dir}" />
	    
    </postGoal>
   
	<postGoal name="dist:prepare-src-filesystem">
	
        <attainGoal name="readme"/>
		<ant:copy todir="${maven.dist.src.assembly.dir}">
		  <ant:fileset dir="${basedir}">
			<ant:include name="NOTICE*"/>
			<ant:include name="struts_checks.xml"/>
			<ant:include name="README.txt"/>
			<ant:include name="xdocs/**"/>
		  </ant:fileset>
		</ant:copy>
      
	</postGoal>

    <goal name="readme" description="Generates readme">
        <ant:java classname="org.apache.xalan.xslt.Process" fork="true">
            <ant:classpath>
                <ant:path refid="maven.dependency.classpath"/>
            </ant:classpath>
            <ant:arg value="-IN" />
            <ant:arg value="${basedir}/project.xml" />
            <ant:arg value="-OUT" />
            <ant:arg value="${basedir}/README.txt" />
            <ant:arg value="-XSL" />
            <ant:arg value="${basedir}/xdocs/README.xsl" />
        </ant:java>    
 
    </goal>
                     

</project>
