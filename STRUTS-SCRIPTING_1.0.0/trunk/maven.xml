<?xml version="1.0"?>

<project    default="dist"
            xmlns:j="jelly:core"
            xmlns:ant="jelly:ant"
            xmlns:maven="jelly:maven">


    <postGoal name="dist">
		<attainGoal name="jar:install"/>
	</postGoal>

	<postGoal name="dist:prepare-bin-filesystem">

      <attainGoal name="jar:jar"/>
      <attainGoal name="readme"/>
      <ant:echo message="jar ${maven.build.dir}/${maven.final.name}.jar" />
      <ant:copy todir="${maven.dist.bin.assembly.dir}">
		  <ant:fileset dir="${basedir}">
			<ant:include name="NOTICE*"/>
			<ant:include name="README.txt"/>
		  </ant:fileset>
		</ant:copy>
  
      <ant:mkdir dir="${basedir}/dist" />
      <ant:copy file="${maven.build.dir}/${maven.final.name}.jar" 
                todir="${basedir}/dist" />
      <ant:ant dir="${basedir}" antfile="build.xml" target="example">
        <ant:property name="nojar" value="nojar" />
      </ant:ant>  

      <!--
      <ant:unzip src="${basedir}/dist/struts-example.war"
             dest="${basedir}/dist/tmp" />
      <ant:copy file="${maven.dist.bin.assembly.dir}/${maven.final.name}.jar" 
                todir="${basedir}/dist/tmp/WEB-INF/lib" />
      <ant:zip destfile="${basedir}/dist/struts-example.war"
               basedir="${basedir}/dist/tmp" />
     --> 
      <ant:copy file="${basedir}/dist/struts-example.war" 
                todir="${maven.dist.bin.assembly.dir}" />
	    
    </postGoal>
   
	<postGoal name="dist:prepare-src-filesystem">
	
        <attainGoal name="readme"/>
		<ant:copy todir="${maven.dist.src.assembly.dir}">
		  <ant:fileset dir="${basedir}">
			<ant:include name="NOTICE*"/>
			<ant:include name="struts_checks.xml"/>
			<ant:include name="README.txt"/>
			<ant:include name="xdocs/**"/>
		  </ant:fileset>
		</ant:copy>
      
	</postGoal>

    <goal name="readme" description="Generates readme">
        <ant:java classname="org.apache.xalan.xslt.Process" fork="true">
            <ant:classpath>
                <ant:path refid="maven.dependency.classpath"/>
            </ant:classpath>
            <ant:arg value="-IN" />
            <ant:arg value="${basedir}/project.xml" />
            <ant:arg value="-OUT" />
            <ant:arg value="${basedir}/README.txt" />
            <ant:arg value="-XSL" />
            <ant:arg value="${basedir}/xdocs/README.xsl" />
        </ant:java>    
 
    </goal>
                     

</project>
